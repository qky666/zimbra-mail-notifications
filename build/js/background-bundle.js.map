{"version":3,"sources":["webpack:///webpack/bootstrap adf0643c63281bdd3efd","webpack:///./src/background.js","webpack:///./src/lib/CoordinadorZimbra.js","webpack:///./src/lib/constantes.js","webpack:///./src/lib/GestorAlarma.js","webpack:///./src/lib/GestorServidor.js","webpack:///./src/lib/LogZimbra.js","webpack:///./src/lib/OpcionesStorage.js","webpack:///./src/lib/ServidorZimbra.js","webpack:///./src/lib/GestorBadge.js","webpack:///./src/lib/GestorMensajes.js","webpack:///./src/lib/GestorNotificaciones.js","webpack:///./src/lib/UtilesFirefox.js","webpack:///./src/lib/UtilesPopup.js","webpack:///./src/lib/ZimbraNavegador.js","webpack:///./src/lib/UtilesURL.js"],"names":["configurarListeners","CoordinadorZimbra","chrome","runtime","onInstalled","addListener","details","runtimeOnInstalledListener","notifications","onClicked","notificationId","notificationsOnClickedListener","onButtonClicked","buttonIndex","notificationsOnButtonClickedListener","onClosed","byUser","notificationsOnClosedListener","alarms","onAlarm","alarm","alarmsOnAlarmListener","tabs","onActivated","activeInfo","tabsOnActivatedListener","windows","onFocusChanged","windowId","windowsOnFocusChangedListener","browserAction","tab","browserActionOnClickedListener","storage","onChanged","changes","areaName","storageOnChangedListener","escucharWebNavigationOnCompleted","parametros","callback","getServidor","servidor","actualizarMensajesNoleidos","actualizarUis","notificacion","notificarMensajes","establecerDistintivoEnBoton","ba","getBrowserActionPopupSiAbiero","actualizarDatos","abrirOActivarZimbra","limpiarNotificacion","wasCleared","hayNotificacionActiva","activa","zimbraActivo","activo","log","openOptionsPage","establecerAlarma","ID_NOTIF_CORREO","getMensajes","datos","JSON","stringify","mensajesNoOcultos","addMensajeOculto","actualizarMensajes","abrirOActivarZimbraYLimpiarNotificacion","name","ID_ALARMA_CORREO","siZimbraActivoLimpiarNotificacion","hasOwnProperty","webNavigationOnCompletedListenerWrap","webNavigationOnCompletedListener","webNavigation","onCompleted","removeListener","urlError","url","urlAsURL","hostEquals","host","close","borrarMensajesOcultos","mensajesNoLeidos","noOcultos","ocultos","mensajesOcultos","estado","periodoOverride","logs","urlZimbraDefecto","minutosIntervaloDefecto","mostrarNotificacionesDefecto","notificacionesPermanentesDefecto","GestorAlarma","urlAsString","clear","getOpciones","opciones","periodo","minutosIntervalo","create","delayInMinutes","periodInMinutes","GestorServidor","_this","_servidor","urlZimbra","init","LogZimbra","cadena","date","Date","console","error","OpcionesStorage","local","remove","nuevasOpciones","Array","isArray","set","get","mostrarNotificaciones","notificacionesPermanentes","items","ServidorZimbra","_urlAsString","_mensajes","_estadoCarga","_ultimaConsulta","ahora","getTime","usarCache","query","urlBase","protocol","urlJson","codificarQueryURL","cb","cargando","window","fetch","_actualizarNoLeidosFetch","_actualizarNoLeidosXHR","thisZimbraServer","xhr","XMLHttpRequest","open","timeout","withCredentials","onload","status","_establecerErrorRequest","statusText","_jsonAMensajes","responseText","onerror","e","send","credentials","method","headers","Headers","append","mode","cache","then","response","ok","text","Promise","reject","Error","reason","message","myText","i18n","getMessage","json","jsonStr","replace","jsonParsed","parse","mens","m","i","length","mensJson","Mensaje","push","idMensaje","mensaje","filtro","currentValue","id","filtrado","mensajes","filter","strToURL","stringToURL","GestorBadge","setBadgeBackgroundColor","color","setBadgeText","num","toString","GestorMensajes","nuevosMensajesOcultos","_getIdsMensajesOcultos","idsOcultos","mensajeConId","getId","arrayIds","map","_setIdsMensajesOcultos","_getMensajesOcultos","idsMensajesServidor","indexOf","_setMensajesOcultos","nuevosMensajes","mensajesOcultosActualizados","idsMensajesOcultos","_sanearMensajesOcultos","GestorNotificaciones","iconUrl","titulo","notificationOptions","type","title","requireInteraction","navegadorEsFirefox","list","de","buttons","join","getAll","UtilesFirefox","navigator","userAgent","includes","UtilesPopup","popups","extension","getViews","popup","document","ZimbraNavegador","_tabsConZimbraAbierto","update","focused","active","getLastFocused","populate","win","estadosValidos","state","highlighted","lastFocusedWindow","UtilesURL","ret","d","encodeURIComponent","codificarParametrosQueryURL","string","URL","err","mensajeError"],"mappings":"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","file":"background-bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap adf0643c63281bdd3efd\n **/","/*\r\n * Script que corre en el background\r\n */\r\n\r\nimport CoordinadorZimbra from './lib/CoordinadorZimbra.js'\r\n\r\n//Arrancamos\r\nCoordinadorZimbra.configurarListeners()\r\n//CoordinadorZimbra.actualizarMensajes({notificacion:false}, function () {} )\n\n\n/** WEBPACK FOOTER **\n ** ./src/background.js\n **/","import constantes from './constantes.js'\r\n//import CoordinadorZimbra from './CoordinadorZimbra.js')\r\nimport GestorAlarma from './GestorAlarma.js'\r\nimport GestorBadge from './GestorBadge.js'\r\nimport GestorMensajes from './GestorMensajes.js'\r\nimport GestorNotificaciones from './GestorNotificaciones.js'\r\nimport GestorServidor from './GestorServidor.js'\r\nimport LogZimbra from './LogZimbra.js'\r\n//import Mensaje from './Mensaje.js'\r\n//import OpcionesStorage from './OpcionesStorage.js'\r\n//import ServidorZimbra from './ServidorZimbra.js'\r\n//import UtilesFirefox from './UtilesFirefox.js'\r\nimport UtilesPopup from './UtilesPopup.js'\r\n//import UtilesURL from './UtilesURL.js'\r\nimport ZimbraNavegador from './ZimbraNavegador.js'\r\n\r\n\r\nexport default class CoordinadorZimbra {\r\n\r\n\tconstructor () {\r\n\t}\r\n\r\n\tstatic configurarListeners () {\r\n\t\t\r\n\t\t//Pongo este listener el primero para que se ejecute cuando se instala (si lo pongo en el callback parece que no se ejecuta a tiempo)\r\n\t\tif (chrome && chrome.runtime && chrome.runtime.onInstalled && chrome.runtime.onInstalled.addListener) {\r\n\t\t\tchrome.runtime.onInstalled.addListener(function(details) {\r\n\t\t\t\tCoordinadorZimbra.runtimeOnInstalledListener(details)\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t//De hecho, pongo todos los listener primero aquí para evitar que algunas cosas se \"pierdan\" si lo pongo en el callback\r\n\t\t//Listeners\t\t\r\n\t\tchrome.notifications.onClicked.addListener(function (notificationId) {\r\n\t\t\tCoordinadorZimbra.notificationsOnClickedListener(notificationId)\r\n\t\t})\r\n\r\n\t\tif (chrome && chrome.notifications && chrome.notifications.onButtonClicked && chrome.notifications.onButtonClicked.addListener){\r\n\t\t\tchrome.notifications.onButtonClicked.addListener(function(notificationId, buttonIndex) {\r\n\t\t\t\tCoordinadorZimbra.notificationsOnButtonClickedListener(notificationId, buttonIndex)\r\n\t\t\t})\t\r\n\t\t}\r\n\t\t\r\n\t\tchrome.notifications.onClosed.addListener(function (notificationId, byUser) {\r\n\t\t\tCoordinadorZimbra.notificationsOnClosedListener(notificationId, byUser)\r\n\t\t})\r\n\r\n\t\tchrome.alarms.onAlarm.addListener(function (alarm) {\r\n\t\t\tCoordinadorZimbra.alarmsOnAlarmListener(alarm)\r\n\t\t})\r\n\r\n\t\tchrome.tabs.onActivated.addListener(function (activeInfo) {\r\n\t\t\tCoordinadorZimbra.tabsOnActivatedListener(activeInfo)\r\n\t\t})\r\n\t\r\n\t\tchrome.windows.onFocusChanged.addListener(function (windowId) {\r\n\t\t\tCoordinadorZimbra.windowsOnFocusChangedListener(windowId)\r\n\t\t})\r\n\r\n\t\tchrome.browserAction.onClicked.addListener(function (tab) {\r\n\t\t\tCoordinadorZimbra.browserActionOnClickedListener(tab)\r\n\t\t})\r\n\r\n\t\tchrome.storage.onChanged.addListener(function(changes,areaName) {\r\n\t\t\tCoordinadorZimbra.storageOnChangedListener(changes,areaName)\r\n\t\t})\r\n\t\t\r\n\t\tCoordinadorZimbra.escucharWebNavigationOnCompleted()\r\n\r\n\t}\r\n\r\n\r\n\t/*************************************************************************\r\n\t* Funciones de Alto Nivel (afectan a UI)\r\n\t**************************************************************************/\r\n\r\n\t//Parámetros: {notificacion:Boolean}\r\n\tstatic actualizarMensajes (parametros, callback) {\r\n\r\n\t\tGestorServidor.getServidor(function(servidor) {\r\n\r\n\t\t\tservidor.actualizarMensajesNoleidos (function () {\r\n\r\n\t\t\t\tCoordinadorZimbra.actualizarUis(parametros)\r\n\t\t\t\tcallback()\r\n\r\n\t\t\t})\t\r\n\r\n\t\t})\r\n\t}\r\n\r\n\t\r\n\t//Parámetros: {notificacion:Boolean}\r\n\tstatic actualizarUis (parametros) {\r\n\t\tif (parametros.notificacion) {\r\n\t\t\tGestorNotificaciones.notificarMensajes()\r\n\t\t}\r\n\t\t\r\n\t\tGestorBadge.establecerDistintivoEnBoton()\r\n\r\n\t\t\r\n\t\tlet ba = UtilesPopup.getBrowserActionPopupSiAbiero()\r\n\t\tif (ba) {\r\n\t\t\tba.actualizarDatos()\r\n\t\t} \r\n\t}\r\n\r\n\r\n\tstatic abrirOActivarZimbraYLimpiarNotificacion () {\r\n\t\tZimbraNavegador.abrirOActivarZimbra()\r\n\t\tGestorNotificaciones.limpiarNotificacion(function (wasCleared) {})\r\n\t}\r\n\r\n\r\n\tstatic siZimbraActivoLimpiarNotificacion () {\r\n\t\tGestorNotificaciones.hayNotificacionActiva(function (activa) {\r\n\t\t\tif (activa === true) {\r\n\t\t\t\tZimbraNavegador.zimbraActivo ( function (activo) {\r\n\t\t\t\t\tif (activo) {\r\n\t\t\t\t\t\tGestorNotificaciones.limpiarNotificacion(function (wasCleared) {})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\r\n\t/*************************************************************************\r\n\t* Listeners\r\n\t**************************************************************************/\r\n\t\r\n\tstatic runtimeOnInstalledListener(details) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Runtime On Installed Listener. Inicio\")\r\n\t\tchrome.runtime.openOptionsPage( function () {} )\r\n\t\tGestorAlarma.establecerAlarma()\r\n\t}\r\n\r\n\r\n\tstatic notificationsOnButtonClickedListener (notificationId, buttonIndex) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Notifications On Button Clicked Listener. Inicio\")\r\n\t\tif (notificationId == constantes.ID_NOTIF_CORREO && buttonIndex == 0) {\r\n\t\t\t\r\n\t\t\tGestorNotificaciones.limpiarNotificacion(function (wasCleared) {})\r\n\r\n\t\t\tGestorAlarma.establecerAlarma()\r\n\r\n\t\t\tGestorMensajes.getMensajes (function(datos) {\r\n\t\t\t\tLogZimbra.log(\"CoordinadorZimbra. callback de Get Mensajes. Vamos a añadir mensajes ocultos: \"+ JSON.stringify(datos.mensajesNoOcultos))\r\n\t\t\t\tGestorMensajes.addMensajeOculto(datos.mensajesNoOcultos, function(){\r\n\t\t\t\t\tCoordinadorZimbra.actualizarMensajes({notificacion:false},function(){})\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t}\t\r\n\t}\r\n\r\n\r\n\tstatic notificationsOnClickedListener (notificationId) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Notifications On Clicked Listener. Inicio\")\r\n\t\tif (notificationId == constantes.ID_NOTIF_CORREO) {\r\n\t\t\tCoordinadorZimbra.abrirOActivarZimbraYLimpiarNotificacion()\r\n\t\t\tGestorAlarma.establecerAlarma()\r\n\t\t}\t\t\r\n\t}\r\n\r\n\r\n\tstatic notificationsOnClosedListener (notificationId, byUser) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Notifications On Closed Listener. Inicio\")\r\n\t\tif (notificationId == constantes.ID_NOTIF_CORREO && byUser) {\r\n\t\t\tGestorAlarma.establecerAlarma()\r\n\t\t}\t\t\r\n\t}\r\n\r\n\r\n\tstatic alarmsOnAlarmListener (alarm) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Alarms On Alarm Listener. Inicio\")\r\n\t\tif (alarm && alarm.name == constantes.ID_ALARMA_CORREO) {\r\n\t\t\tLogZimbra.log(\"CoordinadorZimbra. Alarms On Alarm Listener. alarm.name=\" + alarm.name)\r\n\t\t\tCoordinadorZimbra.actualizarMensajes({notificacion:true}, function () {} )\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tstatic tabsOnActivatedListener (activeInfo) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Tabs On Activated Listener. Inicio\")\r\n\t\tCoordinadorZimbra.siZimbraActivoLimpiarNotificacion()\r\n\t}\r\n\r\n\tstatic webNavigationOnCompletedListener () {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Web Navigation On Completed Listener. Inicio\")\r\n\t\tCoordinadorZimbra.siZimbraActivoLimpiarNotificacion()\r\n\t}\r\n\r\n\r\n\tstatic windowsOnFocusChangedListener (windowId) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. Windows On Focus Changed Listener. Inicio\")\r\n\t\tCoordinadorZimbra.siZimbraActivoLimpiarNotificacion()\t\r\n\t}\r\n\r\n\t// Si hay popup asociado, este método no se llama, así que nos sirve de poco...\r\n\tstatic browserActionOnClickedListener (tab) {\r\n\t\tGestorNotificaciones.limpiarNotificacion(function (wasCleared) {})\r\n\t\tCoordinadorZimbra.actualizarMensajes({notificacion:false}, function(){})\r\n\t}\r\n\r\n\tstatic storageOnChangedListener (changes,areaName) {\r\n\t\tif (changes.hasOwnProperty(\"opciones\")){\r\n\t\t\tGestorAlarma.establecerAlarma()\r\n\t\t\tCoordinadorZimbra.escucharWebNavigationOnCompleted()\r\n\t\t\tCoordinadorZimbra.actualizarMensajes({notificacion:true}, function (){})\r\n\t\t}\r\n\t}\r\n\t/*************************************************************************\r\n\t* Gestión de listeners condicionales\r\n\t**************************************************************************/\t\r\n\tstatic escucharWebNavigationOnCompleted () {\r\n\t\t\r\n\t\tlet webNavigationOnCompletedListenerWrap = function () {\r\n\t\t\tCoordinadorZimbra.webNavigationOnCompletedListener()\r\n\t\t}\r\n\t\r\n\t\tchrome.webNavigation.onCompleted.removeListener(webNavigationOnCompletedListenerWrap)\r\n\t\t\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\r\n\t\t\tif (servidor.urlError) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet url = servidor.urlAsURL\r\n\t\t\tchrome.webNavigation.onCompleted.addListener(webNavigationOnCompletedListenerWrap, {url: [{hostEquals:url.host}]} )\r\n\r\n\t\t})\r\n\t\t\r\n\t}\r\n\r\n\t/*************************************************************************\r\n\t* Llamados desde la UI\r\n\t**************************************************************************/\r\n\r\n\tstatic onLoadBrowserAction (callback) {\r\n\t\tLogZimbra.log(\"CoordinadorZimbra. On Load Browser Action. Inicio\")\r\n\t\tGestorNotificaciones.limpiarNotificacion(function (wasCleared) {})\r\n\t\tCoordinadorZimbra.actualizarMensajes({notificacion:false},callback)\r\n\t}\r\n\r\n\tstatic onClickMensaje () {\r\n\t\tlet ba = UtilesPopup.getBrowserActionPopupSiAbiero()\r\n\t\tif (ba) {\r\n\t\t\tba.close()\r\n\t\t}\r\n\t\tCoordinadorZimbra.abrirOActivarZimbraYLimpiarNotificacion()\r\n\t\tGestorAlarma.establecerAlarma()\r\n\t}\r\n\r\n\tstatic onMostrarOcultos () {\r\n\t\tGestorMensajes.borrarMensajesOcultos(function(){\r\n\t\t\tCoordinadorZimbra.actualizarMensajes({notificacion:false},function(){})\r\n\t\t})\r\n\t}\r\n\r\n\t/****************************************************\r\n\t* Consulta de estado general\r\n\t*****************************************************/\r\n\t//callback: function (datos:object)\r\n\t//Los datos son de este estilo:\r\n\t//datos\r\n\t//\tmensajesNoLeidos\r\n\t//\t\tocultos:[Mensaje]\r\n\t//\t\tnoOcultos:[Mensaje]\r\n\t//\testado\r\n\t//\t\tok:(true opcional)\r\n\t//\t\terror:(String opcional)\r\n\t//\t\tcargando:(true opcional)\r\n\tstatic getDatos (callback) {\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\t\t\tGestorMensajes.getMensajes(function(datos){\r\n\t\t\t\tcallback({\r\n\t\t\t\t\tmensajesNoLeidos:{\r\n\t\t\t\t\t\tnoOcultos:datos.mensajesNoOcultos,\r\n\t\t\t\t\t\tocultos:datos.mensajesOcultos\r\n\t\t\t\t\t},\r\n\t\t\t\t\testado:servidor.estado\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/CoordinadorZimbra.js\n **/","const periodoOverride = false //false //0.25\r\nconst logs = true\r\n\r\n// Otras constantes\r\nconst ID_ALARMA_CORREO = \"IdAlarmaCorreoZimbra\"\r\nconst ID_NOTIF_CORREO = \"IdNotificacionCorreoZimbra\"\r\n\r\nconst urlZimbraDefecto = \"\"\r\nconst minutosIntervaloDefecto = 1\r\nconst mostrarNotificacionesDefecto = true\r\nconst notificacionesPermanentesDefecto = false\r\n\r\n\r\n\r\nexport default {\r\n\tperiodoOverride:periodoOverride,\r\n\tlogs:logs,\r\n\tID_ALARMA_CORREO:ID_ALARMA_CORREO,\r\n\tID_NOTIF_CORREO:ID_NOTIF_CORREO,\r\n\turlZimbraDefecto:urlZimbraDefecto,\r\n\tminutosIntervaloDefecto:minutosIntervaloDefecto,\r\n\tmostrarNotificacionesDefecto:mostrarNotificacionesDefecto,\r\n\tnotificacionesPermanentesDefecto:notificacionesPermanentesDefecto\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/constantes.js\n **/","import constantes from \"./constantes.js\"\r\n\r\nimport GestorServidor from './GestorServidor.js'\r\nimport OpcionesStorage from './OpcionesStorage.js'\r\n\r\n\r\n\r\n\r\nexport default class GestorAlarma {\r\n\tconstructor () {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic establecerAlarma () {\r\n\r\n\t\tGestorServidor.getServidor(function(servidor) {\r\n\t\t\t// Si la url está vacía, no pongo alarma\r\n\t\t\tif (servidor.urlAsString == \"\") {\r\n\t\t\t\tchrome.alarms.clear(constantes.ID_ALARMA_CORREO, function (wasCleared) {} )\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tOpcionesStorage.getOpciones(function(opciones) {\r\n\t\t\t  let periodo = opciones.minutosIntervalo\r\n\t\t\t  // Si estamos en modo test, hago que la alarma salte más a menudo\r\n\t\t\t  if (constantes.periodoOverride) {\r\n\t\t\t    periodo = constantes.periodoOverride\r\n\t\t\t  }\r\n\r\n\t\t\t  chrome.alarms.create(constantes.ID_ALARMA_CORREO, {delayInMinutes:periodo, periodInMinutes: periodo});  \t\t\r\n\t\t\t}) \r\n\t\t})\r\n\t}\r\n\t\t\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/GestorAlarma.js\n **/","import LogZimbra from './LogZimbra.js'\r\nimport OpcionesStorage from './OpcionesStorage.js'\r\nimport ServidorZimbra from './ServidorZimbra.js'\r\n\r\n\r\nexport default class GestorServidor {\r\n\tconstructor () {\r\n\t\treturn null\r\n\t}\r\n\r\n\t//callback: function (servidor) {...}\r\n\tstatic getServidor(callback) {\r\n\t\tlet _this = this\r\n\t\t//let servidorPrevio = this._servidor\r\n\t\tOpcionesStorage.getOpciones(function(opciones){\r\n\t\t\t\r\n\t\t\tLogZimbra.log(\"Gestor Servidor. Get Servidor. Voy a mirar si existe servidor previo\")\r\n\t\t\tif (_this._servidor) {\r\n\t\t\t\tLogZimbra.log(\"Gestor Servidor. Get Servidor. Sí existe servidor previo: _this._servidor.urlAsString=\" + \r\n\t\t\t\t\t_this._servidor.urlAsString + \". opciones.urlZimbra=\" + opciones.urlZimbra)\t\t\t\t\r\n\t\t\t\tif (_this._servidor.urlAsString == opciones.urlZimbra) {\r\n\t\t\t\t\tLogZimbra.log(\"Gestor Servidor. Get Servidor. Existe servidor previo y la URL es la buena\")\t\t\t\t\r\n\t\t\t\t\tcallback (_this._servidor)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t} \r\n\r\n\t\t\tLogZimbra.log(\"Gestor Servidor. Get Servidor. Estoy creando un nuevo servidor\")\r\n\t\t\t_this._servidor = new ServidorZimbra(opciones.urlZimbra)\r\n\t\t\t_this._servidor.init(function(){\r\n\t\t\t\tcallback(_this._servidor)\r\n\t\t\t})\r\n\t\t\r\n\t\t})\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/GestorServidor.js\n **/","import constantes from './constantes.js'\r\n\r\nexport default class LogZimbra {\r\n\tconstrctor() {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic log(cadena) {\r\n\t\tif (!constantes.logs) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet date = new Date()\r\n\t\tconsole.log(date + \". \" + cadena)\r\n\t}\r\n\r\n\tstatic error(cadena) {\r\n\t\tlet date = new Date()\r\n\t\tconsole.error(date + \". \" + cadena)\t\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/LogZimbra.js\n **/","import constantes from './constantes.js'\r\n\r\nimport LogZimbra from './LogZimbra.js'\r\n\r\nexport default class OpcionesStorage {\r\n\tconstructor () {\r\n\t\treturn null\r\n\t}\r\n\r\n\t//callback: function () {...}\r\n\tstatic borrarOpciones (callback) {\r\n\t\tchrome.storage.local.remove([\"opciones\"], callback)\r\n\t}\r\n\r\n\t//callback: function () {...}\r\n\tstatic setOpciones (nuevasOpciones, callback) {\r\n    if (typeof(nuevasOpciones) != 'object' || Array.isArray(nuevasOpciones)) {\r\n      LogZimbra.error(\"Hemos intentado grabas unas opciones incorrectas\")\r\n    }\r\n\t\tchrome.storage.local.set({opciones:nuevasOpciones}, callback)\r\n\t}\r\n\r\n\t//callback: function (opciones) {...}\r\n \tstatic getOpciones(callback) {\r\n\t\tchrome.storage.local.get(\r\n\t  \t{\r\n\t\t\t\topciones: {\r\n\t\t\t\t\turlZimbra: constantes.urlZimbraDefecto,\r\n          minutosIntervalo: constantes.minutosIntervaloDefecto,\r\n          mostrarNotificaciones: constantes.mostrarNotificacionesDefecto,\r\n          notificacionesPermanentes: constantes.notificacionesPermanentesDefecto\r\n        }\r\n      }, \r\n      function(items) {\r\n        LogZimbra.log(\"OpcionesStorage. Get Opciones. Leído: items=\"+JSON.stringify(items))\r\n        let opciones = items.opciones\r\n\r\n        //Comprobamos que lo que leemos tiene buena pinta\r\n        if (typeof(opciones) != 'object' || Array.isArray(opciones)) {\r\n          opciones = {}\r\n        }\r\n        \r\n        if (opciones.urlZimbra == null) {\r\n        \topciones.urlZimbra = constantes.urlZimbraDefecto\r\n        }\r\n        if (opciones.minutosIntervalo == null) {\r\n        \topciones.minutosIntervalo = constantes.minutosIntervaloDefecto\r\n        }\r\n        if (opciones.mostrarNotificaciones == null) {\r\n        \topciones.mostrarNotificaciones = constantes.mostrarNotificacionesDefecto\r\n        }\r\n        if (opciones.notificacionesPermanentes == null) {\r\n        \topciones.notificacionesPermanentes = constantes.notificacionesPermanentesDefecto\r\n        }\r\n        \r\n        callback(opciones)\r\n      }\r\n    )\r\n\t}\r\n\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/OpcionesStorage.js\n **/","import LogZimbra from './LogZimbra.js'\r\nimport UtilesURL from './UtilesURL.js'\r\n\r\nexport default class ServidorZimbra {\r\n\tconstructor(urlAsString) {\r\n\t\tthis._urlAsString = urlAsString\r\n\t\tthis._mensajes = []\r\n\t\t//this._errorRequest = \"¡No inicializado!\"\r\n\t\tthis._estadoCarga = {error:\"¡No inicializado!\"}\r\n\t\tthis._ultimaConsulta = null\r\n\t}\r\n\r\n\tget urlAsString () \t\t\t\t\t{return this._urlAsString}\r\n\t\r\n\tget mensajes \t\t() \t\t\t\t\t{return this._mensajes}\r\n\r\n\tget urlAsURL\t\t()\t\t\t\t\t{\r\n\t\tlet strToURL = UtilesURL.stringToURL(this._urlAsString)\r\n\t\tif (strToURL.hasOwnProperty('error')) {\r\n\t\t\treturn null\r\n\t\t}\r\n\t\treturn strToURL.url\r\n\t}\r\n\t\r\n\tget urlError\t\t()\t\t\t\t\t{\r\n\t\tlet strToURL = UtilesURL.stringToURL(this._urlAsString)\r\n\t\tif (strToURL.hasOwnProperty('error')) {\r\n\t\t\treturn strToURL.error\r\n\t\t}\r\n\t\treturn null\r\n\t}\r\n\r\n\tget error \t\t\t()\t\t\t\t\t{\r\n\t\tif (this.urlError) {\r\n\t\t\treturn this.urlError\r\n\t\t}\r\n\t\tif (this._estadoCarga.error) {\r\n\t\t\treturn this._estadoCarga.error\r\n\t\t} \r\n\t\treturn null\r\n\t}\r\n\r\n\tget estado \t\t\t()\t\t\t\t\t{\r\n\t\tif (this.urlError) {\r\n\t\t\treturn {error:this.urlError}\r\n\t\t}\r\n\t\treturn JSON.parse(JSON.stringify(this._estadoCarga))\r\n\t}\r\n\t\r\n\tinit (callback) {\r\n\t\tthis.actualizarMensajesNoleidos(callback)\r\n\t}\r\n\r\n\t\r\n\tusarCache() {\r\n\t\tif (this.error) {\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tlet ahora = new Date()\r\n\t\tif ( this._ultimaConsulta && (ahora.getTime()-this._ultimaConsulta.getTime()<2000) ) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t}\t\r\n\r\n\r\n\t// callback: function ()\r\n\tactualizarMensajesNoleidos (callback) {\r\n\t\tif (this.urlError) {\r\n\t\t\tthis._mensajes = null\r\n\t\t\tthis._estadoCarga = {error:this.urlError}\r\n\t\t\tcallback()\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (this.usarCache()) {\r\n\t\t\t// Voy a usar caché, o sea, no actualizo realmente los mensajes.\r\n\t\t\tcallback()\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet url = this.urlAsURL\r\n\r\n\t  let parametros = { query: \"is:unread\" }\r\n\t  let urlBase = url.protocol + \"//\" +  url.host + \"/home/~/inbox.json\"\r\n\t  let urlJson = UtilesURL.codificarQueryURL(urlBase, parametros)\r\n\r\n\t  let _this = this\r\n\t  let cb = function () {\r\n\t  \t_this._ultimaConsulta = new Date()\r\n\t  \tcallback()\r\n\t  }\r\n\r\n\t  this._estadoCarga = {cargando:true}\r\n\t  if (window.fetch) {\r\n\t  \tthis._actualizarNoLeidosFetch(urlJson, cb)\r\n\t  } else {\r\n\t  \tthis._actualizarNoLeidosXHR(urlJson, cb)\r\n\t  }\r\n\t}\r\n\r\n\r\n\t_actualizarNoLeidosXHR (urlJson, callback) {\r\n\t\tLogZimbra.log(\"GestorZimbra. Actualizar No Leidos XHR. Inicio\")\r\n\r\n\t\tlet thisZimbraServer = this\r\n\r\n\t  let xhr = new XMLHttpRequest()\r\n\t  xhr.open(\"GET\", urlJson, true)\r\n\t  xhr.timeout = 4000\r\n\t  xhr.withCredentials = true\r\n\r\n\t  xhr.onload = function() {\r\n\t\t  // Hemos terminado y ha ido bien.\r\n\t\t  // Debido a un error en la respuesta del servidor de correo web Zimbra, debemos hacer una transformación de la respuesta.\r\n\t  \t// El problema es que en la respuesta se incluye texto del tipo \"\\x\". Este texto no puede aparecer en un JSON correcto,\r\n\t  \t// así que lo sustituimos por \"\\u00\", que debería ser lo mismo\r\n\t  \tif (this.status != 200) {\r\n\t  \t\t// Algo no ha ido bien\r\n\t  \t\tthisZimbraServer._establecerErrorRequest(this.statusText)\r\n\t  \t\tcallback()\r\n\t  \t\treturn\r\n\t  \t}\r\n\r\n\t\t\tthisZimbraServer._jsonAMensajes (this.responseText)\r\n\t\t  callback()\r\n\t\t  return\r\n\t\t}\r\n\r\n\t\txhr.onerror = function (e) {\r\n\t\t\tthisZimbraServer._establecerErrorRequest(this.statusText)\r\n\t\t\tcallback()\r\n\t\t\treturn\r\n\t\t}\r\n\t\txhr.send()\r\n\t}\r\n\r\n\t_actualizarNoLeidosFetch (urlJson, callback) {\r\n\t\tLogZimbra.log(\"GestorZimbra. Actualizar No Leidos Fetch. Inicio\")\r\n\t\tlet thisZimbraServer = this\r\n\r\n\t\twindow.fetch(urlJson, \r\n\t\t            {\tcredentials:'include',\r\n\t\t\t            method: 'GET',\r\n\t\t\t            headers: new Headers().append('Content-Type', 'text/plain'),\r\n\t\t\t            mode: 'cors',\r\n\t\t\t            cache: 'default'\r\n\t\t            }\r\n\t\t            )\r\n\t  .then(function(response) {\r\n\t    if (response && response.ok) {\r\n\t      return response.text()  \r\n\t    } else {\r\n\t    \tif (response && response.statusText) {\r\n\t      \tthisZimbraServer._establecerErrorRequest(response.statusText)\r\n\t      } else {\r\n\t      \tthisZimbraServer._establecerErrorRequest(null)\r\n\t      }\r\n\t      callback()\r\n\t  \t\treturn Promise.reject(new Error(\"Response no ok\"))\r\n\t    } \r\n\t  },function(reason) {\r\n\t  \t\tif (reason && reason.message) {\r\n\t  \t\t\tthisZimbraServer._establecerErrorRequest(reason.message)\r\n\t  \t\t} else {\r\n\t  \t\t\tthisZimbraServer._establecerErrorRequest(null)\r\n\t  \t\t}\r\n\t  \t\tcallback()\r\n\t  \t\treturn Promise.reject(new Error(\"Promise rechazada\"))\r\n\t  })\r\n\t  .then(function(myText) {\r\n\t    thisZimbraServer._jsonAMensajes(myText)\r\n\t    callback()\r\n\t    return\r\n\t  })\r\n\r\n\t}\r\n\r\n\t_establecerErrorRequest (error) {\r\n\t\tlet e\r\n\t\tif (error) {\r\n\t\t\te = error\r\n\t\t} else {\r\n\t\t\te = chrome.i18n.getMessage(\"error_generico\")\r\n\t\t}\r\n\r\n\t\tthis._estadoCarga = {error:e}\r\n\t\tthis._mensajes = null\r\n\t}\r\n\r\n\t_jsonAMensajes (json) {\r\n\t\tlet jsonStr = json.replace(/\\\\x/g,\"\\\\u00\")\r\n    let jsonParsed = JSON.parse(jsonStr)\r\n\r\n\t\tlet mens = []\r\n    if (jsonParsed.m) {\r\n      for (let i = 0; i < jsonParsed.m.length; i++) {\r\n      \tlet mensJson = jsonParsed.m[i]\r\n        let m = new Mensaje(mensJson)\r\n        mens.push(m)\r\n      }\r\n    }\r\n\r\n    this._estadoCarga = {ok:true}\r\n  \tthis._mensajes = mens\r\n\t  return\r\n\t}\r\n\r\n\tmensajeConId (idMensaje) {\r\n\t\tlet mensaje = null\r\n\r\n\t\tfunction filtro (currentValue) {\r\n\t\t\treturn currentValue.id == idMensaje\r\n\t\t}\r\n\r\n\t\tlet filtrado = this.mensajes.filter(filtro)\r\n\r\n\t\tif (filtrado.length) {\r\n\t\t\tmensaje = filtrado[0]\r\n\t\t\tLogZimbra.log(\"Servidor Zimbra. Mensaje Con Id. He encontrado el mensaje: \" + JSON.stringify(mensaje))\r\n\t\t} else {\r\n\t\t\tLogZimbra.log(\"Servidor Zimbra. Mensaje Con Id. No he encontrado el mensaje con id: \" + idMensaje)\r\n\t\t}\r\n\r\n\t\treturn mensaje\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/ServidorZimbra.js\n **/","import GestorMensajes from './GestorMensajes.js'\r\nimport GestorServidor from './GestorServidor.js'\r\n\r\nexport default class GestorBadge {\r\n\tconstructor() {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic establecerDistintivoEnBoton () {\r\n\t\t\r\n\t\tGestorServidor.getServidor(function(servidor) {\r\n\r\n\t\t\tif (servidor.error) {\r\n\t\t\t\tchrome.browserAction.setBadgeBackgroundColor({color: [240, 0, 0, 255]})\r\n\t\t\t\tchrome.browserAction.setBadgeText({text: \"X\"})\r\n\t\t\t} else {\r\n\t\t\t\tGestorMensajes.getMensajes (function (datos) {\r\n\t\t\t\t\tlet num = datos.mensajesNoOcultos.length\r\n\t\t\t\t\tchrome.browserAction.setBadgeText({text: num.toString()})\r\n\t\t\t\t\tif (num == 0) {\r\n\t\t\t\t\t\tchrome.browserAction.setBadgeBackgroundColor({color: [0, 0, 220, 255]})\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchrome.browserAction.setBadgeBackgroundColor({color: [0, 190, 0, 255]})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/GestorBadge.js\n **/","import GestorServidor from './GestorServidor.js'\r\nimport LogZimbra from './LogZimbra.js'\r\n\r\nexport default class GestorMensajes {\r\n  constructor () {\r\n    return null\r\n  }\r\n\r\n  //callback: function () {...}\r\n  static borrarMensajesOcultos (callback) {\r\n    LogZimbra.log(\"Gestor Mensajes. Borrar Mensajes Ocultos. Inicio\")\r\n    chrome.storage.local.remove([\"mensajesOcultos\"], callback)\r\n  }\r\n\r\n  //callback: function () {...}\r\n  static _setIdsMensajesOcultos (nuevosMensajesOcultos, callback) {\r\n    if(!Array.isArray(nuevosMensajesOcultos)) {\r\n      LogZimbra.error(\"Hemos intentado grabar mensajes ocultos incorrectos\")\r\n      return\r\n    }\r\n    chrome.storage.local.set({mensajesOcultos:nuevosMensajesOcultos}, callback)\r\n    LogZimbra.log(\"Gestor Mensajes. _Set Ids Mensajes Ocultos. Grabados: \" + JSON.stringify(nuevosMensajesOcultos))\r\n  }\r\n\r\n  //callback: function ([int] idsMensajesOcultos) {...}\r\n  static _getIdsMensajesOcultos(callback) {\r\n    chrome.storage.local.get(\"mensajesOcultos\", function(items) {\r\n      let mensajesOcultos = []\r\n      if (items.mensajesOcultos && Array.isArray(items.mensajesOcultos)) {\r\n        LogZimbra.log(\"Gestor Mensajes. _Get Ids Mensajes Ocultos. La lectura ha sido buena!\")\r\n        mensajesOcultos = items.mensajesOcultos\r\n      }\r\n      LogZimbra.log(\"Gestor Mensajes. _Get Ids Mensajes Ocultos. Leídos: \" + JSON.stringify(mensajesOcultos))\r\n      callback(mensajesOcultos)\r\n    })\r\n  }\r\n\r\n  //callback: function ([Mensaje] mensajesOcultos) {...}\r\n  static _getMensajesOcultos (callback) {\r\n    GestorServidor.getServidor(function(servidor) {\r\n      GestorMensajes._getIdsMensajesOcultos (function (idsOcultos) {\r\n        let mensajesOcultos = []\r\n        for (let i = 0; i < idsOcultos.length; i++) {\r\n          let m = servidor.mensajeConId(idsOcultos[i])\r\n          if (m) {\r\n            mensajesOcultos.push(m)\r\n          }\r\n        }\r\n        LogZimbra.log(\"Gestor Mensajes. _Get Mensajes Ocultos. mensajesOcultos obtenidos: \" + JSON.stringify(mensajesOcultos))\r\n        callback(mensajesOcultos)\r\n      })\r\n    })\r\n  }\r\n\r\n  //callback: function () {...}\r\n  static _setMensajesOcultos (mensajesOcultos, callback) {\r\n    \r\n      if (!mensajesOcultos.length) {\r\n        LogZimbra.log(\"Gestor Mensajes. _Set Mensajes Ocultos. Voy a llamar a Borrar Mensajes Ocultos\")\r\n        GestorMensajes.borrarMensajesOcultos(callback)\r\n        return\r\n      }\r\n\r\n      function getId (currentValue) {\r\n        return currentValue.id\r\n      }\r\n\r\n      let arrayIds = mensajesOcultos.map(getId)\r\n      GestorMensajes._setIdsMensajesOcultos(arrayIds,callback)\r\n  }\r\n\r\n  //callback: function () {...}\r\n  static _sanearMensajesOcultos (callback) {\r\n    GestorServidor.getServidor(function(servidor){\r\n\r\n      if (servidor.error) {\r\n        // Hay un error al conectar con Zimbra. No es buen momento para \"sanear\".\r\n        callback()\r\n        return\r\n      }\r\n\r\n      GestorMensajes._getMensajesOcultos (function (mensajesOcultos) {\r\n        \r\n        function filtro (currentValue) {\r\n          let idsMensajesServidor = servidor.mensajes.map(m => m.id)\r\n          if (idsMensajesServidor.indexOf(currentValue.id) < 0 ) {\r\n            return false\r\n          } else {\r\n            return true\r\n          }\r\n        } \r\n        \r\n        LogZimbra.log(\"Gestor Mensajes. _Sanear Mensajes Ocultos. Voy a llamar a _Set Mensajes Ocultos con: \" \r\n          + JSON.stringify(mensajesOcultos.filter(filtro)))\r\n        GestorMensajes._setMensajesOcultos(mensajesOcultos.filter(filtro), callback)\r\n      \r\n      })\r\n\r\n    })\r\n\r\n    \r\n  }\r\n\r\n\r\n  // Se permite añadir un Mensaje o un Array de Mensajes\r\n  // Incluye Sanear Mensajes Ocultos\r\n  //callback: function () {...}\r\n  static addMensajeOculto (datos, callback) {\r\n\r\n    let nuevosMensajes = datos\r\n    // Nos aseguramos de que es un array\r\n    if (datos instanceof Mensaje) {\r\n      nuevosMensajes = [datos]\r\n    }\r\n\r\n    GestorMensajes._getMensajesOcultos (function (mensajesOcultos) { \r\n      \r\n      let mensajesOcultosActualizados = mensajesOcultos\r\n\r\n      let idsMensajesOcultos = mensajesOcultos.map(m => m.id)\r\n\r\n      for (var i = 0; i < nuevosMensajes.length; i++) {\r\n        if (idsMensajesOcultos.indexOf(nuevosMensajes[i].id) < 0) {\r\n          mensajesOcultosActualizados.push(nuevosMensajes[i])\r\n        }\r\n      }\r\n\r\n      LogZimbra.log(\"Gestor Mensajes. Add Mensaje Oculto. Voy a llamar a _Set Mensajes Ocultos con: \" \r\n        + JSON.stringify(mensajesOcultosActualizados))\r\n      GestorMensajes._setMensajesOcultos(mensajesOcultosActualizados, function() {\r\n        GestorMensajes._sanearMensajesOcultos(callback)\r\n      })\r\n    }) \r\n\r\n  }\r\n\r\n\r\n  //callback: function ({mensajesNoOcultos:[Mensaje], mensajesOcultos:[Mensaje]})\r\n  static getMensajes (callback) {\r\n\r\n    GestorServidor.getServidor(function(servidor) {\r\n\r\n      GestorMensajes._getMensajesOcultos(function (mensajesOcultos) {\r\n        function filtro (currentValue) {\r\n          if (mensajesOcultos.indexOf(currentValue) < 0) {\r\n            return true\r\n          } else {\r\n            return false\r\n          }\r\n        }\r\n\r\n        let mensajesNoOcultos = servidor.mensajes?servidor.mensajes.filter(filtro):[]\r\n        callback({mensajesNoOcultos:mensajesNoOcultos, mensajesOcultos:mensajesOcultos})\r\n      })\r\n\r\n    })\r\n\r\n    \r\n  }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/GestorMensajes.js\n **/","import constantes from './constantes.js'\r\n\r\nimport GestorMensajes from './GestorMensajes.js'\r\nimport GestorServidor from './GestorServidor.js'\r\n//import LogZimbra from './LogZimbra.js'\r\nimport OpcionesStorage from './OpcionesStorage.js'\r\nimport UtilesFirefox from './UtilesFirefox.js'\r\nimport UtilesPopup from './UtilesPopup.js'\r\nimport ZimbraNavegador from './ZimbraNavegador.js'\r\n\r\n\r\nexport default class GestorNotificaciones {\r\n\tconstructor () {\r\n\t\treturn null\r\n\t}\r\n\r\n\t/*************************************************************************\r\n\t* Notificaciones\r\n\t**************************************************************************/\r\n\t/**\r\n\t * Limpia la notificación que genera esta extensión\r\n\t * callback: function (boolean wasCleared) {...}\r\n\t */\r\n\tstatic limpiarNotificacion (callback) {\r\n\t  chrome.notifications.clear(constantes.ID_NOTIF_CORREO, callback)\r\n\t}\r\n\r\n\r\n\tstatic notificarMensajes () {\r\n\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\r\n\t\t\t// Si la URL está vacía, no notifico nada. Se supone que quien sea pondrá una url en algún momento...\r\n\t\t\tif (servidor.urlAsString == \"\") {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\r\n\t\t\tif (UtilesPopup.getBrowserActionPopupSiAbiero()) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tOpcionesStorage.getOpciones(function(opciones) {\r\n\t\t\t\tif (!opciones.mostrarNotificaciones) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\r\n\t\t\t\tZimbraNavegador.zimbraActivo(function (activo) { \r\n\t\t\t\t\tif (activo) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//Si hay error\r\n\t\t\t\t\tif(servidor.error) {\r\n\t\t\t\t\t\tlet iconUrl = \"img/48_mail_error.png\"\r\n\t\t\t\t\t\tlet titulo = chrome.i18n.getMessage(\"notif_zimbra_mail_error\")\r\n\r\n\t\t\t\t\t\tlet notificationOptions = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          type: \"basic\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          title: titulo,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          iconUrl: iconUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          message: servidor.error,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          requireInteraction: opciones.notificacionesPermanentes\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t        }\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t//Ñapa para que funcione en Firefox también\r\n\t\t\t\t\t\tif (UtilesFirefox.navegadorEsFirefox()) {\r\n\t\t\t\t\t\t\tnotificationOptions = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"basic\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t          title: titulo,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t          iconUrl: iconUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t          message: servidor.error,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tchrome.notifications.create(constantes.ID_NOTIF_CORREO, notificationOptions, function (notificationId) {} )\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t  GestorMensajes.getMensajes (function (datos) {\r\n\t\t\t\t\t\tlet list = []\r\n\t\t\t\t\t  for (let i = 0; i < datos.mensajesNoOcultos.length; i++) {\r\n\t\t\t\t\t  \tlet m = datos.mensajesNoOcultos[i]\r\n\t\t\t\t\t  \tlist.push({title:m.de, message:m.titulo})\r\n\t\t\t\t\t  }\r\n\r\n\t\t\t\t  \tif (list.length > 0) {\r\n\t\t\t\t\t  \tlet iconUrl = \"img/48.png\"\r\n\t\t\t\t\t  \tlet titulo = chrome.i18n.getMessage(\"notif_zimbra_mail\") + \". \" + chrome.i18n.getMessage(\"new_mail_notification_message\",list.length.toString())\r\n\t\t\t\t\t  \tlet mensaje =\"Zimbra Mail. \" + chrome.i18n.getMessage(\"new_mail_notification_message\",list.length.toString())\r\n\r\n\t\t\t\t\t    let notificationOptions = {\r\n\t\t\t\t\t      type: \"list\",\r\n\t\t\t\t\t      title: titulo,\r\n\t\t\t\t\t      iconUrl: iconUrl,\r\n\t\t\t\t\t      message: mensaje,\r\n\t\t\t\t\t      items: list,\r\n\t\t\t\t\t      requireInteraction: opciones.notificacionesPermanentes,\r\n\t\t\t\t\t      buttons:[{title:chrome.i18n.getMessage(\"notif_do_not_show_again_for_these_messages\")}]\r\n\t\t\t\t\t    }\r\n\r\n\r\n\t\t\t\t\t\t\tif (UtilesFirefox.navegadorEsFirefox()) {\r\n\t\t\t\t\t\t\t\tnotificationOptions = {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: \"basic\",\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          title: titulo,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          iconUrl: iconUrl,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t          message: list.map(i => i.title+\": \"+i.message).join(\"\\n\"),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\r\n\r\n\t\t\t\t\t    chrome.notifications.create(constantes.ID_NOTIF_CORREO, notificationOptions, function (notificationId) {} )\r\n\t\t\t\t\t  }\r\n\t\t\t\t  })\r\n\t\t\t\t})\r\n\t\t\t})\r\n\r\n\t\t})\r\n\t\t\r\n\t}\r\n\r\n\r\n\tstatic hayNotificacionActiva (callback) {\r\n\t\tchrome.notifications.getAll(function (notifications) {\r\n\t\t\tif (notifications && notifications[constantes.ID_NOTIF_CORREO]) {\r\n\t\t\t\tcallback(true)\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tcallback(false)\r\n\t\t})\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/GestorNotificaciones.js\n **/","export default class UtilesFirefox {\r\n\t\r\n\tconstructor() {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic navegadorEsFirefox() {\r\n\t\treturn window.navigator.userAgent.includes(\"Firefox\")\r\n\t}\r\n\t\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/UtilesFirefox.js\n **/","export default class UtilesPopup {\r\n\tconstructor() {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic getBrowserActionPopupSiAbiero () {\r\n\t\tlet popups = chrome.extension.getViews({type: 'popup'})\r\n\t\tlet popup = null\r\n\t\tfor (let i=0;i<popups.length;i++) {\r\n\t\t\tif (popups[i].document.title == chrome.i18n.getMessage(\"ba_default_title\")) {\r\n\t\t\t\tpopup = popups[i]\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn popup\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/UtilesPopup.js\n **/","import GestorServidor from './GestorServidor.js'\r\n//let LogZimbra from './LogZimbra.js')\r\n\r\nexport default class ZimbraNavegador {\r\n\tconstructor () {\r\n\t\treturn null\r\n\t}\r\n\r\n\t// callback: function (tabs) {...}\r\n\tstatic _tabsConZimbraAbierto (callback) {\r\n\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\r\n\t\t\tif(servidor.urlError) {\r\n\t\t\t\tcallback([])\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tlet url = servidor.urlAsURL\r\n\r\n\t\t  chrome.tabs.query( \r\n\t\t\t\t\t\t\t          {\r\n\t\t\t\t\t\t\t           status:\"complete\", \r\n\t\t\t\t\t\t\t           url:\"*://\"+url.host+\"/*\"\r\n\t\t\t\t\t\t\t          }, function (tabs) {\r\n\t\t\t\t\t\t\t          \tcallback (tabs)\r\n\t\t\t\t\t\t\t            return\r\n\t\t\t\t\t\t\t          } \r\n\t\t\t)\r\n\r\n\t\t})\r\n\t}\r\n\r\n\r\n\tstatic abrirOActivarZimbra () {\r\n\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\r\n\t\t\tif (servidor.urlError) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tlet url = servidor.urlAsURL\r\n\t\t \tZimbraNavegador._tabsConZimbraAbierto (function (tabs) {\r\n\t\t \t\tif (tabs.length) {\r\n\t\t \t\t\tchrome.windows.update(tabs[0].windowId, { focused: true })\r\n\t\t      chrome.tabs.update(tabs[0].id, { active: true })\r\n\t\t \t\t} else if (url) {\r\n\t\t \t\t\tchrome.tabs.create({ active: true, url: url.toString() })\r\n\t\t \t\t} else {\r\n\t\t \t\t\treturn\r\n\t\t \t\t}\r\n\t\t \t})\r\n\t\t})\r\n\t}\r\n\r\n\t/**\r\n\t * Comprueba si Zimbra está activo ahora (o sea, está abierto y el usuario lo está \"viendo\")\r\n\t * @param callback: function (boolean activo). Función callback \r\n\t */\r\n\tstatic zimbraActivo (callback) {\r\n\t\tGestorServidor.getServidor(function(servidor){\r\n\r\n\t\t\tif(servidor.urlError) {\r\n\t\t\t\tcallback(false)\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet url = servidor.urlAsURL\r\n\t\t\t  \r\n\t\t  chrome.windows.getLastFocused({populate:true},function (win) {\r\n\t\t        \r\n\t\t    // Si la ventana no está \"focused\", consideramos que la ventana del navegador no está activa\r\n\t\t    if (win.focused === false) {\r\n\t\t      callback(false)\r\n\t\t      return\r\n\t\t    }\r\n\r\n\t\t    // Si aún hay opciones de que Zimbra esté activo, \r\n\t\t    // miramos el estado de la ventana. Si no está en la lista, consideramos que Zimbra no está activo\r\n\t\t    let estadosValidos = [\"normal\", \"maximized\", \"fullscreen\"]\r\n\t\t    if (estadosValidos.indexOf(win.state) < 0) {\r\n\t\t      callback(false)\r\n\t\t      return\r\n\t\t    }\r\n\t\t    \r\n\t\t    chrome.tabs.query( \r\n\t\t      {active:true, \r\n\t\t       highlighted:true, \r\n\t\t       lastFocusedWindow:true, \r\n\t\t       status:\"complete\", url:\"*://\"+url.host+\"/*\"\r\n\t\t      }, function (tabs) {\r\n\t\t        if (tabs.length) {\r\n\t\t          callback(true)\r\n\t\t          return\r\n\t\t        } else {\r\n\t\t          callback(false)\r\n\t\t          return\r\n\t\t        }\r\n\t\t      } \r\n\t\t    )\r\n\t\t  \r\n\t\t  })\r\n\r\n\t\t})\r\n\t}\r\n\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/ZimbraNavegador.js\n **/","export default class UtilesURL {\r\n\t\r\n\tconstructor() {\r\n\t\treturn null\r\n\t}\r\n\r\n\tstatic codificarParametrosQueryURL(parametros){\r\n\t  let ret = [];\r\n\t  for (let d in parametros) {\r\n\t    ret.push(encodeURIComponent(d) + \"=\" + encodeURIComponent(parametros[d]));\r\n\t  }\r\n\t  return ret.join(\"&\");\r\n\t}\r\n\r\n\tstatic codificarQueryURL(urlBase,parametros) {\r\n\t\treturn urlBase + \"?\" + UtilesURL.codificarParametrosQueryURL(parametros)\r\n\t}\r\n\r\n\tstatic stringToURL(string) {\r\n\t\tlet url \r\n\t\ttry {\r\n\t\t\turl = new URL(string)\r\n\t\t}\r\n\t\tcatch (err) {\r\n\t\t\tlet mensajeError = err.message\r\n\t\t\tif (!mensajeError) {\r\n\t\t\t\tmensajeError = \"Error creando URL\"\r\n\t\t\t}\r\n\t\t\treturn {error:mensajeError}\r\n\t\t}\r\n\t\treturn {url:url}\r\n\t}\r\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/lib/UtilesURL.js\n **/"],"sourceRoot":""}